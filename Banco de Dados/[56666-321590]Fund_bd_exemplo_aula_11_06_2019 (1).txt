CREATE TABLE CLIENTE (
        CD_CLI NUMBER(5) NOT NULL,
        NM_CLI VARCHAR2(40) NOT NULL,
        CPF_CLI NUMBER(11) NOT NULL
        );
ALTER TABLE CLIENTE ADD CONSTRAINT CLI_PK PRIMARY KEY (CD_CLI);
CREATE INDEX NM_CLI_I ON CLIENTE(NM_CLI);
ALTER TABLE CLIENTE ADD CONSTRAINT CPF_CLI_UK UNIQUE (CPF_CLI);

CREATE TABLE VENDA (
        CD_VEN NUMBER(5) NOT NULL,
        DT_VEN DATE NOT NULL,
        CD_CLI NUMBER(5) NOT NULL
        );
ALTER TABLE VENDA ADD CONSTRAINT VEN_PK 
        PRIMARY KEY (CD_VEN,CD_CLI);
ALTER TABLE VENDA ADD CONSTRAINT VEN_CLI_FK 
        FOREIGN KEY (CD_CLI) REFERENCES CLIENTE(CD_CLI);
CREATE INDEX VEN_CLI_FK_I ON VENDA(CD_CLI);
CREATE INDEX DT_VEN_I ON VENDA(DT_VEN);

CREATE TABLE PARCELA (
        CD_PAR NUMBER(5) NOT NULL,
        VL_PAR NUMBER(9,2) NOT NULL,
        CD_VEN NUMBER(5) NOT NULL,
        CD_CLI NUMBER(5) NOT NULL
        );
ALTER TABLE PARCELA ADD CONSTRAINT PAR_PK 
        PRIMARY KEY (CD_PAR,CD_VEN,CD_CLI);
ALTER TABLE PARCELA ADD CONSTRAINT PAR_VEN_FK
        FOREIGN KEY (CD_VEN,CD_CLI) REFERENCES VENDA(CD_VEN,CD_CLI);
CREATE INDEX PAR_VEN_FK_I ON PARCELA(CD_VEN,CD_CLI);
ALTER TABLE CLIENTE ADD CD_CLI_SUP NUMBER(5);
ALTER TABLE CLIENTE ADD CONSTRAINT CLI_SUP_FK
        FOREIGN KEY (CD_CLI_SUP) 
        REFERENCES CLIENTE(CD_CLI);
INSERT INTO CLIENTE (CD_CLI,NM_CLI,CPF_CLI,CD_CLI_SUP)
  VALUES (1,'JOAO DA SILVA',998443,NULL);
INSERT INTO CLIENTE (CD_CLI,NM_CLI,CPF_CLI,CD_CLI_SUP)
  VALUES (2,'PEDRO DA ROSA',998442,NULL);
INSERT INTO VENDA (CD_VEN,DT_VEN,CD_CLI)
  VALUES (1,'11/06/2019', 1);
INSERT INTO PARCELA (CD_PAR,CD_VEN,CD_CLI,VL_PAR)
  VALUES (1,1,1,155.48);
INSERT INTO PARCELA (CD_PAR,CD_VEN,CD_CLI,VL_PAR)
  VALUES (2,1,1,158.48);
INSERT INTO PARCELA (CD_PAR,CD_VEN,CD_CLI,VL_PAR)
  VALUES (3,1,1,159.48);
UPDATE PARCELA SET VL_PAR=155.48
  WHERE CD_PAR=2 AND CD_VEN=1 AND CD_CLI=1;
DELETE PARCELA WHERE CD_CLI=1 AND CD_VEN=1 
  AND CD_PAR=3;
ALTER TABLE PARCELA DROP CONSTRAINT PAR_VEN_FK;
DROP TABLE VENDA;
SELECT * FROM CLIENTE;
INSERT INTO CLIENTE VALUES (3,'MARIA PEDROSA',94485,1);
SELECT * FROM CLIENTE;
commit;