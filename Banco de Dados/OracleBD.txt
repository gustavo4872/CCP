CREATE USER U01 IDENTIFIED BY U01;
GRANT CONNECT, RESOURCE TO U01;

U01 | SENHA: U01

--Listar Tabelas--
desc user_tables
SELECT TABLE_NAME FROM user_tables



TABLE EMPREGADO
CD_EMP INTEGER NOT NULL PK
NM_EMP VARCHAR(50) NOT NULL
E_CHEFE VARCHAR(50) NOT NULL
CD_DEP INTEGER NOT NULL	FK(CD_DEP|DEPARTAMENTO)

TABLE DEPARTAMENTO
CD_DEP INTEGER NOT NULL PK
NM_DEP VARCHAR(50) NOT NULL

TABLE PROJETO
CD_PRO INTEGER NOT NULL PK
DS_PRO NOT NULL
CD_DEP INTEGER NOT NULL FK(CD_DEP|DEPARTAMENTO)

TABLE PARTICIPACAO_PROJETO
CD_EMP INTEGER NOT NULL PK FK(CD_EMP|EMPREGADO)
CD_PRO INTEGER NOT NULL PK FK(CD_PRO|PROJETO)



TABLE ORQUESTRA
CD_ORQ INTEGER NOT NULL PK
NM_ORQ VARCHAR(50) NOT NULL
NM_PAIS VARCHAR(50) NOT NUL
DT_CRIA DATE NOT NULL

TABLE SINFONIA
CD_SIN INTEGER NOT NULL PK
NM_SIN VARCHAR(50) NOT NULL
NM_COMP VARCHAR(50) NOT NULL
DT_CRIA DATE NOT NULL
CD_ORQ INTEGER NOT NULL FK(CD_ORQ|ORQUESTRA)

CREATE TABLE CIDADE (
            CD_CID NUMBER(5) NOT NULL,
            NM_CID VARCHAR2(30) NOT NULL,
            CD_UF VARCHAR2(2) NOT NULL
);
ALTER TABLE CIDADE ADD CONSTRAINT CID_PK PRIMARY KEY (CD_CID);
CREATE INDEX NM_CID_I ON CIDADE (NM_CID);

CREATE TABLE FORNECEDOR (
            NR_CNPJ NUMBER(14) NOT NULL,
            NM_FOR VARCHAR2(30) NOT NULL,
            NM_LOGR VARCHAR2(40) NOT NULL,
            NR_LOGR VARCHAR2(15),
            NM_BAIRR VARCHAR2(30) NOT NULL,
            NR_CEP NUMBER(8) NOT NULL,
            CD_CID NUMBER(5) NOT NULL
);
ALTER TABLE FORNECEDOR ADD CONSTRAINT FORN_PK PRIMARY KEY (NR_CNPJ);
ALTER TABLE FORNECEDOR ADD CONSTRAINT FORN_CID_FK FOREIGN KEY (CD_CID) REFERENCES CIDADE (CD_CID);
CREATE INDEX FORN_CID_FK_I ON FORNECEDOR (CD_CID);
CREATE INDEX NM_FOR_I ON FORNECEDOR (NM_FOR);

CREATE TABLE INSUMO (
            CD_INS NUMBER(5) NOT NULL,
            NM_INS VARCHAR2(40) NOT NULL,
            TP_INS VARCHAR2(30) NOT NULL
            );
ALTER TABLE INSUMO ADD CONSTRAINT INS_PK PRIMARY KEY (CD_INS);
ALTER TABLE INSUMO ADD CONSTRAINT TP_INS_CK CHECK (TP_INS IN('PRODUTO','SERVICO'));
CREATE INDEX NM_INS_I ON INSUMO(NM_INS);

CREATE TABLE OBRA (
            CD_OBR NUMBER(5) NOT NULL,
            NM_OBR VARCHAR2(40) NOT NULL,            
            NM_LOGR VARCHAR2(40) NOT NULL,
            NR_LOGR VARCHAR2(15),
            NM_BAIR VARCHAR2(30) NOT NULL,
            NR_CEP NUMBER(8) NOT NULL,
            CD_CID NUMBER(5) NOT NULL
);
ALTER TABLE OBRA ADD CONSTRAINT OBR_PK PRIMARY KEY (CD_OBR);
ALTER TABLE OBRA ADD CONSTRAINT OBR_CID_FK FOREIGN KEY (CD_CID) REFERENCES CIDADE (CD_CID);
CREATE INDEX OBR_CID_FK_I ON OBRA (CD_CID);

CREATE TABLE EMPREGADO (
            NR_CPF NUMBER(10) NOT NULL,
            NM_EMP VARCHAR2(20) NOT NULL,
            DS_FUN VARCHAR2(30) NOT NULL,
            CD_OBR NUMBER(5) NOT NULL
);
ALTER TABLE EMPREGADO ADD CONSTRAINT EMP_PK PRIMARY KEY (NR_CPF);
ALTER TABLE EMPREGADO ADD CONSTRAINT EMP_OBR_FK FOREIGN KEY (CD_OBR) REFERENCES OBRA (CD_OBR);
CREATE INDEX EMP_OBR_FK_I ON EMPREGADO (CD_OBR);

CREATE TABLE INSUMO_FORNECIDO (
            CD_INS NUMBER(5) NOT NULL,
            NR_CNPJ NUMBER(14) NOT NULL
);
ALTER TABLE INSUMO_FORNECIDO ADD CONSTRAINT INF_INS_FK FOREIGN KEY (CD_INS) REFERENCES INSUMO (CD_INS);
ALTER TABLE INSUMO_FORNECIDO ADD CONSTRAINT INF_FORN_FK FOREIGN KEY (NR_CNPJ) REFERENCES FORNECEDOR (NR_CNPJ);
ALTER TABLE INSUMO_FORNECIDO ADD CONSTRAINT INF_PK PRIMARY KEY (CD_INS, NR_CNPJ);
CREATE INDEX INF_INS_FK_I ON INSUMO_FORNECIDO (CD_INS);
CREATE INDEX INF_FORN_I ON INSUMO_FORNECIDO (NR_CNPJ);	

CREATE TABLE COMPRA (
            CD_COM NUMBER(10) NOT NULL,
            DT_COM DATE NOT NULL,
            VL_COM NUMBER(9)NOT NULL,
            DT_PREV DATE,
            NR_CPF NUMBER(10) NOT NULL,
            CD_INS NUMBER(5) NOT NULL,
            NR_CNPJ NUMBER(14) NOT NULL
);
ALTER TABLE COMPRA ADD CONSTRAINT COM_PK PRIMARY KEY (CD_COM);
ALTER TABLE COMPRA ADD CONSTRAINT COM_EMP_FK FOREIGN KEY (NR_CPF) REFERENCES EMPREGADO(NR_CPF);
ALTER TABLE COMPRA ADD CONSTRAINT COM_INF_FK FOREIGN KEY (CD_INS, NR_CNPJ) REFERENCES INSUMO_FORNECIDO(CD_INS, NR_CNPJ);
CREATE INDEX COM_EMP_FK_I ON COMPRA(NR_CPF);
CREATE INDEX COM_INF_FK_I ON COMPRA(CD_INS);

CREATE TABLE PARCELA (
            CD_PAR NUMBER(5) NOT NULL,
            CD_COM NUMBER(10) NOT NULL,
            DT_VCTO DATE NOT NULL,
            VL_PAR NUMBER(9) NOT NULL,
            DT_PGTO DATE,
            VL_PAGO NUMBER(9)
);
ALTER TABLE PARCELA ADD CONSTRAINT PAR_COM_FK FOREIGN KEY (CD_COM) REFERENCES COMPRA (CD_COM);
ALTER TABLE PARCELA ADD CONSTRAINT PAR_PK PRIMARY KEY (CD_PAR, CD_COM);
CREATE INDEX PAR_COM_FK_I ON PARCELA (CD_COM);

SELECT * FROM CIDADE;
SELECT * FROM OBRA;
SELECT * FROM EMPREGADO;
SELECT * FROM INSUMO_FORNECIDO;
SELECT * FROM INSUMO;
SELECT * FROM FORNECEDOR;
SELECT * FROM COMPRA;
SELECT * FROM PARCELA;
INSERT INTO OBRA VALUES (1, 'X', 'X', 'X', 'X', 1, 1);
INSERT INTO EMPREGADO VALUES (1, 'X', 'X', 1);
INSERT INTO INSUMO_FORNECIDO VALUES (1,1);
INSERT INTO COMPRA VALUES (1, '04/06/2019', 1, '19/06/2019', 1, 1, 1);
INSERT INTO PARCELA VALUES (1, 1, '19/06/2019', 1, '04/06/2019', 1);